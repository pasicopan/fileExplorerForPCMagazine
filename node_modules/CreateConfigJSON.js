var fs = require('fs');
var path = require('path');
var child_process = require('child_process');


var localconfigName = '\\localconfig.json';
function loadDB(a_URL,a_callback) {
    fs.readFile(a_URL+localconfigName, 'utf8',function(err, data) {
        if (err) {
            console.log("FATAL An error occurred trying to read in the file: " + err);
            process.exit(-2);
        }
        if (data) {
                // console.log('data is:',data)
                data = data.replace(/.*?\{/,'{');
                console.log('data2 is:',data)
                dataarr = data.split('');
                // console.log('dataarr is:',dataarr)
            try{
                // console.log(JSON.parse(data))
                a_callback(JSON.parse(data));
            }catch(e){
                console.error('load DB error:',e)
            }
            // a_callback(JSON.parse(data));
        } else {
            console.log("No data in "+localconfigName);
            process.exit(-1);
        }
    });
}

function CreateConfigJSON(){
    var that = this;
    that.init = function(options) {
        console.log('\nZipInteractionFile==================================')
        that.path = options.path;
        process.chdir(that.path);
        var configJSONString = '{'+
            '"htmlauthor": "your name",'+
            '"htmlWidth": "1024",'+
            '"htmlHeight": "768",'+
            '"issueID": 396,'+
            '"cmsip": "192.168.11.9",'+
            '"cmsport": 8888,'+
            '"device": "ipad2",'+
            '"zipcommand": "7z",'+
            '"zipFileType": "*.html *.jpg *.png *.js *.css img css js media images base modules",'+
            '"cookie": "JSESSIONID=abcuc6Lv2fN2Aa0QdtYbu; __g_c=w%3A1%7Cb%3A7; uName=%E6%BD%98%E6%80%9D%E5%98%89; uDepartment=%E5%B9%BF%E5%B7%9E+-+%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E9%83%A8; CMS_USER=70933; role_id=0"'+
        '}';

        fs.writeFile(that.path+localconfigName, configJSONString, function(err) {
            if (err) {
                console.log("FATAL An error occurred trying to write in the file: " + err);
                process.exit(-2);
            }
            window.alert('创建成功，请马上修改名字和cookie')
        });
    }
}



exports.CreateConfigJSON = CreateConfigJSON;